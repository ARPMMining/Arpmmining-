<!DOCTYPE CG84I4GG2S>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ARPM Mining - Home</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous" as="style" onload="this.rel='stylesheet'">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" as="style" onload="this.rel='stylesheet'">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet" as="style" onload="this.rel='stylesheet'">
    <style>
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            font-family: 'Poppins', sans-serif;
            color: #e0e0e0;
            font-size: 16px;
            position: relative;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: linear-gradient(135deg, #1e1e3b, #2a2a4e);
            touch-action: manipulation;
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 160px;
            height: 80px;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 10px;
            z-index: 3000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .loading-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .loading-text {
            font-size: 18px;
            font-weight: bold;
            color: #4DD0E1;
        }

        /* Top Bar */
        .topbar {
            display: flex;
            justify-content: flex-start; /* Changed to flex-start to reduce spacing */
            align-items: center;
            background: linear-gradient(90deg, #1c2526, #2a3d45);
            color: #e0e0e0;
            padding: 8px 10px; /* Reduced padding slightly */
            height: 40px;
            z-index: 2000;
            position: fixed;
            width: 100%;
            top: 0;
        }

        .menu-icon {
            font-size: 20px;
            cursor: pointer;
            touch-action: manipulation;
            transition: transform 0.2s;
            margin-right: 5px; /* Minimal spacing between menu icon and title */
        }

        .menu-icon:hover {
            transform: scale(1.1);
        }

        .title {
            font-size: 16px;
            font-weight: bold;
        }

        .balance-box {
            background: transparent;
            color: #4DD0E1;
            padding: 3px 8px;
            border-radius: 5px;
            font-weight: bold;
            font-size: 12px;
            border: 1px solid #4DD0E1;
            margin-left: auto; /* Pushes balance to the right */
        }

        /* Menu Panel */
        .menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1999;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .menu-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .menu-panel {
            position: fixed;
            top: 0;
            right: -100%;
            width: 70%;
            max-width: 300px;
            height: 100%;
            background: linear-gradient(45deg, #2a2a4e, #3b3b66);
            box-shadow: -5px 0 10px rgba(0, 0, 0, 0.4);
            z-index: 2000;
            padding: 20px;
            overflow-y: auto;
            transition: right 0.3s ease-in-out;
        }

        .menu-panel.active {
            right: 0;
        }

        .close-menu {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 20px;
            color: #4DD0E1;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .close-menu:hover {
            transform: scale(1.2);
        }

        .menu-item {
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            transition: background 0.2s, transform 0.2s;
        }

        .menu-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(5px);
        }

        .menu-item i {
            margin-right: 10px;
            font-size: 16px;
            color: #4DD0E1;
        }

        .menu-item-content {
            margin-top: 10px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            font-size: 12px;
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        .menu-item-content.active {
            display: block;
        }

        .menu-item-content h1 {
            font-size: 16px;
            color: #64B5F6;
            margin-bottom: 8px;
        }

        .menu-item-content h2 {
            font-size: 14px;
            color: #e0e0e0;
            margin-top: 8px;
            padding-bottom: 3px;
        }

        .menu-item-content p {
            margin: 8px 0;
            font-size: 12px;
        }

        .menu-item-content .copy-button {
            background: linear-gradient(45deg, #2E7D32, #66BB6A);
            color: #e0e0e0;
            padding: 6px 12px;
            border-radius: 5px;
            border: none;
            font-size: 14px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.3s;
        }

        .menu-item-content .copy-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.9);
        }

        .menu-item-content .referral-link {
            background: #3a3a50;
            color: #e0e0e0;
            padding: 8px;
            border-radius: 5px;
            font-size: 12px;
            word-break: break-all;
            margin-bottom: 8px;
        }

        .menu-item-content .referral-count {
            font-size: 12px;
            color: #4DD0E1;
            font-weight: bold;
        }

        /* Page Sections */
        .page-section {
            display: none;
            overflow: hidden;
            margin-top: 40px; /* Adjusted for fixed topbar */
        }

        .page-section.active {
            display: block;
        }

        /* Image Section */
        .image-half {
            background-image: url('https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=800&q=80');
            background-size: cover;
            background-position: center;
            height: 250px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .start-button {
            background: linear-gradient(45deg, #2E7D32, #66BB6A);
            border: none;
            border-radius: 50px;
            width: 100px;
            height: 100px;
            font-size: 14px;
            font-weight: bold;
            box-shadow: 0 0 8px rgba(76, 175, 80, 0.7);
            cursor: pointer;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            line-height: 1.2;
            padding: 10px;
            touch-action: manipulation;
            color: #e0e0e0;
            animation: pulse-start 2s infinite;
        }

        @keyframes pulse-start {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 0 8px rgba(76, 175, 80, 0.7);
            }
            50% {
                transform: scale(1.03);
                box-shadow: 0 0 12px rgba(76, 175, 80, 0.9);
            }
        }

        .start-button:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(76, 175, 80, 1);
        }

        /* Advertisement Section */
        .ad-section {
            display: none;
            margin: 8px 12px;
            text-align: center;
            background: linear-gradient(45deg, #2a2a4e, #3b3b66);
            border-radius: 8px;
            padding: 8px;
            border: 2px solid #3a3a50;
            animation: fadeIn 0.5s ease-in-out;
        }

        .ad-section.active {
            display: block;
        }

        .ad-section p {
            font-size: 14px;
            color: #e0e0e0;
            margin: 3px 0;
        }

        @keyframes fadeIn {
            0% { opacity: 0; transform: translateY(10px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            width: 100%;
            background: linear-gradient(90deg, #1e1e3b, #2a2a4e);
            display: flex;
            justify-content: space-around;
            align-items: center;
            height: 50px;
            z-index: 1000;
            border-top: 1px solid #3a3a50;
        }

        .nav-item {
            color: #e0e0e0;
            font-size: 10px;
            text-align: center;
            cursor: pointer;
            user-select: none;
            touch-action: manipulation;
        }

        .nav-item i {
            font-size: 14px;
            display: block;
            margin-bottom: 2px;
        }

        .nav-item.active {
            color: #4DD0E1;
        }

        /* Buttons Container */
        .buttons-container {
            position: absolute;
            bottom: 10px;
            width: 100%;
            padding: 0 10px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .button-group {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            gap: 10px;
            width: 100%;
        }

        .roadmap-button, .invite-button, .daily-bonus-button, .login-bonus-button {
            width: calc(25% - 7.5px);
            height: 50px;
            background: linear-gradient(45deg, #2E7D32, #66BB6A);
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 13px;
            font-weight: bold;
            color: #e0e0e0;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);
            cursor: pointer;
            box-shadow: 0 0 15px rgba(76, 175, 80, 0.7), 0 0 5px rgba(76, 175, 80, 0.5);
            transition: transform 0.2s, box-shadow 0.3s, background 0.5s;
            touch-action: manipulation;
            position: relative;
            overflow: hidden;
        }

        .invite-button, .daily-bonus-button, .login-bonus-button {
            background: linear-gradient(45deg, #D81B60, #F06292);
            box-shadow: 0 0 15px rgba(216, 27, 96, 0.7), 0 0 5px rgba(216, 27, 96, 0.5);
        }

        /* Button Icons */
        .roadmap-button::before {
            content: '\f14e';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            margin-right: 5px;
        }

        .invite-button::before {
            content: '\f0c0';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            margin-right: 5px;
        }

        .daily-bonus-button::before {
            content: '\f06b';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            margin-right: 5px;
        }

        .login-bonus-button::before {
            content: '\f091';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            margin-right: 5px;
        }

        /* Gradient animation for buttons */
        .roadmap-button::after, .invite-button::after, .daily-bonus-button::after, .login-bonus-button::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 200%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.4s ease;
        }

        .roadmap-button:hover:not(:disabled)::after, .invite-button:hover:not(:disabled)::after, .daily-bonus-button:hover:not(:disabled)::after, .login-bonus-button:hover:not(:disabled)::after {
            left: 100%;
        }

        .roadmap-button:hover:not(:disabled), .invite-button:hover:not(:disabled), .daily-bonus-button:hover:not(:disabled), .login-bonus-button:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 0 25px rgba(76, 175, 80, 0.9), 0 0 10px rgba(76, 175, 80, 0.7);
            animation: pulse-button 1s infinite;
        }

        .invite-button:hover:not(:disabled), .daily-bonus-button:hover:not(:disabled), .login-bonus-button:hover:not(:disabled) {
            box-shadow: 0 0 25px rgba(216, 27, 96, 0.9), 0 0 10px rgba(216, 27, 96, 0.7);
        }

        @keyframes pulse-button {
            0%, 100% {
                transform: scale(1.05);
                box-shadow: 0 0 25px rgba(76, 175, 80, 0.9), 0 0 10px rgba(76, 175, 80, 0.7);
            }
            50% {
                transform: scale(1.08);
                box-shadow: 0 0 30px rgba(76, 175, 80, 1), 0 0 15px rgba(76, 175, 80, 0.8);
            }
        }

        /* Content Popups */
        .invite-content, .login-bonus-content {
            display: none;
            position: absolute;
            bottom: 65px;
            background: linear-gradient(45deg, #2a2a4e, #3b3b66);
            color: #e0e0e0;
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0 0 8px rgba(0, 0, 0, 0.3);
            width: 250px;
            font-size: 12px;
            text-align: left;
            z-index: 10000;
            max-height: 350px;
            overflow-y: auto;
            animation: fadeIn 0.5s ease-in-out;
        }

        .invite-content, .login-bonus-content {
            left: 15px;
        }

        .invite-content.active, .login-bonus-content.active {
            display: block;
        }

        .invite-content h1, .login-bonus-content h1 {
            color: #64B5F6;
            font-size: 16px;
            margin-bottom: 8px;
        }

        .invite-content h2, .login-bonus-content h2 {
            color: #e0e0e0;
            font-size: 14px;
            margin-top: 8px;
            padding-bottom: 3px;
        }

        .invite-content ul, .login-bonus-content ul {
            list-style: none;
            padding: 0;
            margin: 8px 0;
        }

        .invite-content li, .login-bonus-content li {
            margin-bottom: 8px;
            font-weight: 600;
        }

        .invite-content p, .login-bonus-content p {
            margin: 8px 0;
            font-size: 12px;
        }

        .copy-button {
            background: linear-gradient(45deg, #2E7D32, #66BB6A);
            color: #e0e0e0;
            padding: 6px 12px;
            border-radius: 5px;
            border: none;
            font-size: 14px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.3s;
            touch-action: manipulation;
        }

        .copy-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.9);
        }

        .referral-link {
            background: #3a3a50;
            color: #e0e0e0;
            padding: 8px;
            border-radius: 5px;
            font-size: 12px;
            word-break: break-all;
            margin-bottom: 8px;
        }

        .referral-count {
            font-size: 12px;
            color: #4DD0E1;
            font-weight: bold;
        }

        /* Update Banner Styles */
        #update-banner {
            position: relative;
            margin: 8px 12px;
            width: calc(100% - 24px);
            height: 36px;
            background: linear-gradient(90deg, #4527A0, #7E57C2);
            color: #e0e0e0;
            overflow: hidden;
            border-radius: 6px;
            border: 1px solid #9575CD;
            direction: ltr;
            display: flex;
            align-items: center;
            box-shadow: 0 4px 8px rgba(123, 81, 157, 0.3);
            z-index: 999;
            user-select: none;
            transition: transform 0.3s ease, opacity 0.3s ease, visibility 0.3s ease;
            animation: fadeIn 0.5s ease-in-out;
        }

        #update-banner.hidden {
            transform: translateY(-100%);
            opacity: 0;
            visibility: hidden;
        }

        #marquee-text {
            white-space: nowrap;
            display: inline-block;
            position: absolute;
            left: 100%;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            font-size: 13px;
            letter-spacing: 0.3px;
            color: #e0e0e0;
            text-shadow: 0 0 4px rgba(255, 255, 255, 0.4);
            opacity: 0;
            transform: translateX(0);
            padding: 0 10px;
            box-sizing: border-box;
        }

        #marquee-text.active {
            animation: marquee 20s linear forwards;
            opacity: 1;
            transition: opacity 0.5s ease;
        }

        #marquee-text::before {
            content: '📢';
            margin-right: 6px;
            display: inline-block;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.2);
                opacity: 0.8;
            }
        }

        #close-banner {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 14px;
            cursor: pointer;
            color: #e0e0e0;
            font-weight: bold;
            transition: color 0.3s ease, transform 0.2s ease;
            z-index: 10000;
        }

        #close-banner:hover {
            color: #4DD0E1;
            transform: translateY(-50%) scale(1.2);
        }

        @keyframes marquee {
            0% {
                transform: translateX(0);
            }
            100% {
                transform: translateX(calc(-100% - 100vw));
            }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            body {
                font-size: 14px;
            }

            .image-half {
                height: 220px;
            }

            .start-button {
                width: 90px;
                height: 90px;
                font-size: 13px;
            }

            #update-banner {
                height: 32px;
                width: calc(100% - 24px);
                margin: 8px 12px;
            }

            #marquee-text {
                font-size: 12px;
            }

            #close-banner {
                font-size: 13px;
                right: 8px;
            }

            .invite-content, .login-bonus-content {
                bottom: 60px;
            }

            .roadmap-button, .invite-button, .daily-bonus-button, .login-bonus-button {
                height: 45px;
                font-size: 12px;
            }

            .menu-panel {
                width: 80%;
            }
        }

        @media (max-width: 480px) {
            body {
                font-size: 14px;
            }

            .image-half {
                height: 200px;
            }

            .start-button {
                width: 80px;
                height: 80px;
                font-size: 12px;
            }

            .bottom-nav {
                height: 45px;
            }

            .nav-item {
                font-size: 9px;
            }

            .nav-item i {
                font-size: 12px;
            }

            .roadmap-button, .invite-button, .daily-bonus-button, .login-bonus-button {
                width: calc(25% - 5px);
                height: 40px;
                font-size: 11px;
                border-radius: 8px;
                box-shadow: 0 0 12px rgba(76, 175, 80, 0.6), 0 0 4px rgba(76, 175, 80, 0.4);
            }

            .invite-button, .daily-bonus-button, .login-bonus-button {
                box-shadow: 0 0 12px rgba(216, 27, 96, 0.6), 0 0 4px rgba(216, 27, 96, 0.4);
            }

            .roadmap-button:hover:not(:disabled), .invite-button:hover:not(:disabled), .daily-bonus-button:hover:not(:disabled), .login-bonus-button:hover:not(:disabled) {
                box-shadow: 0 0 20px rgba(76, 175, 80, 0.8), 0 0 8px rgba(76, 175, 80, 0.6);
            }

            .invite-button:hover:not(:disabled), .daily-bonus-button:hover:not(:disabled), .login-bonus-button:hover:not(:disabled) {
                box-shadow: 0 0 20px rgba(216, 27, 96, 0.8), 0 0 8px rgba(216, 27, 96, 0.6);
            }

            .invite-content, .login-bonus-content {
                width: 200px;
                max-height: 300px;
                bottom: 50px;
            }

            .button-group {
                gap: 6px;
            }

            #update-banner {
                height: 28px;
                width: calc(100% - 24px);
                margin: 8px 12px;
            }

            #marquee-text {
                font-size: 11px;
            }

            #close-banner {
                font-size: 12px;
                right: 6px;
            }

            .menu-panel {
                width: 90%;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-text">Loading...</div>
    </div>

    <!-- Menu Panel -->
    <div class="menu-overlay" id="menu-overlay"></div>
    <div class="menu-panel" id="menu-panel">
        <span class="close-menu" id="close-menu">×</span>
        <div class="menu-item" onclick="window.location.href='profile.html'">
            <i class="fas fa-user"></i>Profile
        </div>
        <div class="menu-item" onclick="window.location.href='wallet.html'">
            <i class="fas fa-wallet"></i>Wallet
        </div>
        <div class="menu-item" onclick="window.location.href='income.html'">
            <i class="fas fa-coins"></i>Income
        </div>
        <div class="menu-item" onclick="toggleMenuItem('menu-invite-content')">
            <i class="fas fa-user-friends"></i>Invite
        </div>
        <div class="menu-item-content" id="menu-invite-content">
            <h1>Invite Friends</h1>
            <p>Share your unique referral link to invite friends and earn a 5% bonus on their mining rewards!</p>
            <h2>Your Referral Link:</h2>
            <div class="referral-link" id="menu-invite-referral-link">Loading...</div>
            <button class="copy-button" onclick="copyReferralLink('menu-invite-referral-link')">Copy Link</button>
            <p class="referral-count" id="menu-invite-referral-count">Referrals: 0</p>
        </div>
        <div class="menu-item" onclick="toggleMenuItem('menu-login-bonus-content')">
            <i class="fas fa-gift"></i>Login Bonus
        </div>
        <div class="menu-item-content" id="menu-login-bonus-content">
            <h1>Login Bonus</h1>
            <p>Claim a one-time login bonus of 50 ARPM tokens!</p>
            <button class="copy-button" id="menu-claim-login-bonus-btn" onclick="claimLoginBonus()">Claim Bonus</button>
        </div>
        <div class="menu-item" onclick="window.location.href='roadmap.html'">
            <i class="fas fa-map"></i>Roadmap
        </div>
        <div class="menu-item" onclick="toggleMenuItem('menu-daily-bonus-content')">
            <i class="fas fa-coins"></i>Daily Bonus
        </div>
        <div class="menu-item-content" id="menu-daily-bonus-content">
            <h1>Daily Bonus</h1>
            <p id="menu-daily-bonus-text">Claim your daily bonus!</p>
            <button class="copy-button" id="menu-daily-bonus-btn">Day 1</button>
        </div>
        <div class="menu-item" onclick="window.location.href='https://arpmmining.github.io/Arpmmining-/privacy-policy.html'">
            <i class="fas fa-shield-alt"></i>Privacy Policy
        </div>
        <div class="menu-item" onclick="window.location.href='https://arpmmining.github.io/Arpmmining-/contact.html'">
            <i class="fas fa-envelope"></i>Contact
        </div>
        <div class="menu-item">
            <i class="fas fa-wallet"></i>Balance: <span id="menu-balance">0.000 ARPM</span>
        </div>
        <div class="menu-item" onclick="signOut()">
            <i class="fas fa-sign-out-alt"></i>Sign Out
        </div>
    </div>

    <!-- Home Section -->
    <div id="homeSection" class="page-section active">
        <div class="topbar">
            <div class="menu-icon" id="menuBtn">⋮</div>
            <div class="title">ARPM Mining</div>
            <div class="balance-box" id="balance-box">Balance: 0.000 ARPM</div>
        </div>
        <div class="image-half">
            <button class="start-button" id="start-mining-btn">START MINING</button>
            <div class="buttons-container">
                <div class="button-group">
                    <div class="invite-button" onclick="toggleInvite()">Invite</div>
                    <div class="login-bonus-button" id="login-bonus-btn" onclick="toggleLoginBonus()">Bonus</div>
                    <div class="roadmap-button" onclick="window.location.href='roadmap.html'">Roadmap</div>
                    <div class="daily-bonus-button" id="daily-bonus-btn">Daily Bonus</div>
                    <div class="invite-content" id="invite-content">
                        <h1>Invite Friends</h1>
                        <p>Share your unique referral link to invite friends and earn a 5% bonus on their mining rewards!</p>
                        <h2>Your Referral Link:</h2>
                        <div class="referral-link" id="invite-referral-link">Loading...</div>
                        <button class="copy-button" onclick="copyReferralLink('invite-referral-link')">Copy Link</button>
                        <p class="referral-count" id="invite-referral-count">Referrals: 0</p>
                    </div>
                    <div class="login-bonus-content" id="login-bonus-content">
                        <h1>Login Bonus</h1>
                        <p>Claim a one-time login bonus of 50 ARPM tokens!</p>
                        <button class="copy-button" id="claim-login-bonus-btn" onclick="claimLoginBonus()">Claim Bonus</button>
                    </div>
                </div>
            </div>
        </div>
        <div id="update-banner" class="active">
            <span id="close-banner">×</span>
            <div id="marquee-text"></div>
        </div>
        <div class="ad-section" id="ad-section">
            <p>Advertisement</p>
            <div id="ad-container"></div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav" id="bottom-nav">
        <div class="nav-item active" data-target="homeSection">
            <i class="fas fa-home"></i>Home
        </div>
        <div class="nav-item" data-target="profileSection">
            <i class="fas fa-user"></i>Profile
        </div>
        <div class="nav-item" data-target="walletSection">
            <i class="fas fa-wallet"></i>Wallet
        </div>
        <div class="nav-item" data-target="incomeSection">
            <i class="fas fa-coins"></i>Income
        </div>
    </div>

    <script type="module">
        // Import Firebase functions with error handling
        let auth, db, onAuthStateChanged, signOut, ref, get, update, push;
        try {
            const firebaseModule = await import('./firebase-config.js');
            ({ auth, db, onAuthStateChanged, signOut, ref, get, update, push } = firebaseModule);
        } catch (error) {
            console.error('Failed to load Firebase configuration:', error);
            alert('Error loading Firebase configuration. Please try again later.');
        }

        // DOM Elements
        const elements = {
            homeSection: document.getElementById('homeSection'),
            loadingOverlay: document.getElementById('loading-overlay'),
            startMiningBtn: document.getElementById('start-mining-btn'),
            dailyBonusBtn: document.getElementById('daily-bonus-btn'),
            loginBonusBtn: document.getElementById('login-bonus-btn'),
            balanceBox: document.getElementById('balance-box'),
            inviteReferralLink: document.getElementById('invite-referral-link'),
            inviteReferralCount: document.getElementById('invite-referral-count'),
            adSection: document.getElementById('ad-section'),
            menuBtn: document.getElementById('menuBtn'),
            menuPanel: document.getElementById('menu-panel'),
            menuOverlay: document.getElementById('menu-overlay'),
            closeMenu: document.getElementById('close-menu'),
            menuInviteReferralLink: document.getElementById('menu-invite-referral-link'),
            menuInviteReferralCount: document.getElementById('menu-invite-referral-count'),
            menuBalance: document.getElementById('menu-balance'),
            menuDailyBonusBtn: document.getElementById('menu-daily-bonus-btn'),
            menuDailyBonusText: document.getElementById('menu-daily-bonus-text'),
            menuLoginBonusBtn: document.getElementById('menu-claim-login-bonus-btn'),
            updateBanner: document.getElementById('update-banner')
        };

        // Constants
        const MINING_REWARD = 12;
        const REFERRAL_BONUS_PERCENT = 0.05;
        const DAILY_BONUS_SCHEDULE = [1, 2, 3, 4, 5, 6, 10];
        const LOGIN_BONUS = 50;
        const MINING_DURATION = 12 * 60 * 60 * 1000; // 12 hours in milliseconds

        // Update Banner Script
        const banner = document.getElementById('update-banner');
        const marqueeText = document.getElementById('marquee-text');
        const closeBtn = document.getElementById('close-banner');

        const message = 'Update Notice – ARPM Mining: Website upgrade in progress. Some features may be unavailable. Follow us on X for updates: <span id="x-link" onclick="window.open(\'https://x.com/Arpmmining22\', \'_blank\')">@Arpmmining22</span>';

        function updateMarquee() {
            if (!banner || !marqueeText || banner.classList.contains('hidden') || !elements.homeSection?.classList.contains('active') || elements.menuPanel?.classList.contains('active')) return;

            marqueeText.innerHTML = message;
            const textWidth = marqueeText.offsetWidth;
            const viewportWidth = window.innerWidth;
            const duration = (textWidth / viewportWidth) * 30 + 5;

            marqueeText.classList.remove('active');
            marqueeText.style.transform = 'translateX(0)';
            requestAnimationFrame(() => {
                marqueeText.classList.add('active');
            });

            const timeToFullExit = duration * 1000;
            setTimeout(() => {
                if (!banner.classList.contains('hidden') && elements.homeSection?.classList.contains('active') && !elements.menuPanel?.classList.contains('active')) {
                    updateMarquee();
                }
            }, timeToFullExit);
        }

        if (banner && marqueeText) {
            setTimeout(() => {
                if (!banner.classList.contains('hidden') && elements.homeSection?.classList.contains('active') && !elements.menuPanel?.classList.contains('active')) {
                    updateMarquee();
                }
            }, 1000);
        }

        if (closeBtn) {
            closeBtn.addEventListener('click', () => {
                if (banner) {
                    banner.classList.add('hidden');
                    setTimeout(() => {
                        banner.style.display = 'none';
                    }, 300);
                }
            });
        }

        // Advertisement Configurations
        // Array of ad configurations for displaying random advertisements
        const adConfigs = [
            { key: '0e76a0edb900a6f53aa1a75d1b26bd27', format: 'iframe', height: 250, width: 300, params: {}, scriptSrc: '//www.highperformanceformat.com/0e76a0edb900a6f53aa1a75d1b26bd27/invoke.js' },
            { key: 'eb117daf94e120e0ae0e6f682c2e34f5', format: 'iframe', height: 50, width: 320, params: {}, scriptSrc: '//www.highperformanceformat.com/eb117daf94e120e0ae0e6f682c2e34f5/invoke.js' },
            { key: 'c620af328467e6de19dc04af696ee0fb', format: 'iframe', height: 250, width: 300, params: {}, scriptSrc: '//www.highperformanceformat.com/c620af328467e6de19dc04af696ee0fb/invoke.js' },
            { key: '78ade24182729fceea8e45203dad915b', format: 'iframe', height: 50, width: 320, params: {}, scriptSrc: '//www.highperformanceformat.com/78ade24182729fceea8e45203dad915b/invoke.js' },
            { key: 'update-banner', format: 'iframe', height: 36, width: 320, params: {}, scriptSrc: '//www.highperformanceformat.com/update-banner/invoke.js' }
        ];

        let miningInterval = null;
        let dailyBonusInterval = null;

        /**
         * Toggles the menu panel visibility and controls update banner visibility.
         */
        function toggleMenu() {
            if (elements.menuPanel && elements.menuOverlay && elements.updateBanner) {
                elements.menuPanel.classList.toggle('active');
                elements.menuOverlay.classList.toggle('active');
                if (elements.menuPanel.classList.contains('active')) {
                    elements.updateBanner.classList.add('hidden');
                } else {
                    if (elements.homeSection?.classList.contains('active') && !elements.updateBanner.style.display) {
                        elements.updateBanner.classList.remove('hidden');
                        setTimeout(updateMarquee, 1000);
                    }
                    document.querySelectorAll('.menu-item-content').forEach(item => {
                        item.classList.remove('active');
                    });
                }
            }
        }

        /**
         * Toggles the visibility of a menu item content.
         * @param {string} contentId - The ID of the content to toggle.
         */
        window.toggleMenuItem = (contentId) => {
            const content = document.getElementById(contentId);
            if (!content) return;
            const isActive = content.classList.contains('active');
            document.querySelectorAll('.menu-item-content').forEach(item => {
                item.classList.remove('active');
            });
            if (!isActive) {
                content.classList.add('active');
            }
        };

        /**
         * Displays a random advertisement in the ad container asynchronously.
         */
        function displayRandomAd() {
            const adContainer = document.getElementById('ad-container');
            if (!adContainer || !elements.adSection) return;

            const randomIndex = Math.floor(Math.random() * adConfigs.length);
            const selectedAd = adConfigs[randomIndex];

            window.atOptions = {
                key: selectedAd.key,
                format: selectedAd.format,
                height: selectedAd.height,
                width: selectedAd.width,
                params: selectedAd.params
            };

            adContainer.innerHTML = '';
            const script = document.createElement('script');
            script.type = 'text/javascript';
            script.src = selectedAd.scriptSrc;
            script.async = true;
            script.onload = () => {
                elements.adSection.classList.add('active');
            };
            script.onerror = () => {
                elements.adSection.classList.remove('active');
            };
            adContainer.appendChild(script);
        }

        /**
         * Shows the loading overlay, with reduced delay for optimization.
         * @param {boolean} withDelay - Whether to include a delay before hiding.
         */
        async function showLoadingScreen(withDelay = false) {
            if (!elements.loadingOverlay) return;
            elements.loadingOverlay.classList.add('active');
            if (withDelay) await new Promise(resolve => setTimeout(resolve, 1000));
            elements.loadingOverlay.classList.remove('active');
        }

        /**
         * Formats seconds into a HH:MM:SS string.
         * @param {number} seconds - The time in seconds.
         * @returns {string} Formatted time string.
         */
        function formatTime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        /**
         * Updates the user's balance in Firebase and UI.
         * @param {Object} user - The authenticated user.
         * @param {number} tokens - The new token balance.
         */
        async function updateBalance(user, tokens) {
            if (!user || !elements.balanceBox || !elements.menuBalance) return;
            try {
                const userRef = ref(db, `users/${user.uid}`);
                await update(userRef, { tokens });
                elements.balanceBox.textContent = `Balance: ${tokens.toFixed(3)} ARPM`;
                elements.menuBalance.textContent = `${tokens.toFixed(3)} ARPM`;
            } catch (error) {
                console.error('Error updating balance:', error);
                alert('Failed to update balance. Please try again.');
            }
        }

        /**
         * Updates the daily bonus button based on user data.
         * @param {Object} userData - The user's data from Firebase.
         */
        async function updateDailyBonusButton(userData) {
            if (!elements.dailyBonusBtn || !elements.menuDailyBonusBtn || !elements.menuDailyBonusText) return;

            const lastClaimed = userData.lastDailyBonus || 0;
            const currentDay = userData.dailyBonusDay || 0;
            const now = Date.now();
            const oneDay = 24 * 60 * 60 * 1000;

            if (dailyBonusInterval) clearInterval(dailyBonusInterval);

            if (lastClaimed + oneDay > now) {
                elements.dailyBonusBtn.disabled = true;
                elements.menuDailyBonusBtn.disabled = true;
                let timeLeft = Math.floor((lastClaimed + oneDay - now) / 1000);
                elements.dailyBonusBtn.textContent = formatTime(timeLeft);
                elements.menuDailyBonusBtn.textContent = formatTime(timeLeft);
                elements.menuDailyBonusText.textContent = `Come back in ${formatTime(timeLeft)} to claim your next bonus!`;

                dailyBonusInterval = setInterval(() => {
                    timeLeft--;
                    if (timeLeft <= 0) {
                        clearInterval(dailyBonusInterval);
                        elements.dailyBonusBtn.disabled = false;
                        elements.menuDailyBonusBtn.disabled = false;
                        elements.dailyBonusBtn.textContent = `Day ${currentDay + 1}`;
                        elements.menuDailyBonusBtn.textContent = `Day ${currentDay + 1}`;
                        elements.menuDailyBonusText.textContent = `Claim your Day ${currentDay + 1} bonus!`;
                        elements.dailyBonusBtn.onclick = claimDailyBonus;
                        elements.menuDailyBonusBtn.onclick = claimDailyBonus;
                        return;
                    }
                    elements.dailyBonusBtn.textContent = formatTime(timeLeft);
                    elements.menuDailyBonusBtn.textContent = formatTime(timeLeft);
                    elements.menuDailyBonusText.textContent = `Come back in ${formatTime(timeLeft)} to claim your next bonus!`;
                }, 1000);
            } else {
                elements.dailyBonusBtn.disabled = false;
                elements.menuDailyBonusBtn.disabled = false;
                elements.dailyBonusBtn.textContent = `Day ${currentDay + 1}`;
                elements.menuDailyBonusBtn.textContent = `Day ${currentDay + 1}`;
                elements.menuDailyBonusText.textContent = `Claim your Day ${currentDay + 1} bonus!`;
                elements.dailyBonusBtn.onclick = claimDailyBonus;
                elements.menuDailyBonusBtn.onclick = claimDailyBonus;
            }
        }

        /**
         * Claims the daily bonus and updates user data.
         */
        async function claimDailyBonus() {
            const user = auth.currentUser;
            if (!user) {
                alert('Please login to claim daily bonus!');
                window.location.href = 'login.html';
                return;
            }

            const userRef = ref(db, `users/${user.uid}`);
            try {
                const snapshot = await get(userRef);
                if (!snapshot.exists()) {
                    alert('User data not found.');
                    return;
                }

                const userData = snapshot.val();
                const lastClaimed = userData.lastDailyBonus || 0;
                const now = Date.now();
                const oneDay = 24 * 60 * 60 * 1000;

                if (lastClaimed + oneDay > now) {
                    alert('You can only claim the daily bonus once every 24 hours!');
                    return;
                }

                let currentDay = userData.dailyBonusDay || 0;
                const bonus = DAILY_BONUS_SCHEDULE[currentDay];
                currentDay = (currentDay + 1) % DAILY_BONUS_SCHEDULE.length;
                const newTokens = (userData.tokens || 0) + bonus;

                // Add history entry
                const historyRef = ref(db, `users/${user.uid}/history`);
                await push(historyRef, {
                    type: 'Daily Bonus',
                    amount: bonus,
                    date: new Date().toLocaleDateString('en-GB')
                });

                await update(userRef, {
                    tokens: newTokens,
                    lastDailyBonus: now,
                    dailyBonusDay: currentDay
                });

                // Handle referrer bonus
                if (userData.referredBy) {
                    const referrerRef = ref(db, `users/${userData.referredBy}`);
                    const referrerSnapshot = await get(referrerRef);
                    if (referrerSnapshot.exists()) {
                        const referrerData = referrerSnapshot.val();
                        const bonusAmount = bonus * REFERRAL_BONUS_PERCENT;
                        const referrerTokens = (referrerData.tokens || 0) + bonusAmount;
                        const referrerHistoryRef = ref(db, `users/${userData.referredBy}/history`);
                        await push(referrerHistoryRef, {
                            type: 'Referral Bonus',
                            amount: bonusAmount,
                            date: new Date().toLocaleDateString('en-GB')
                        });
                        await update(referrerRef, { tokens: referrerTokens });
                    }
                }

                updateBalance(user, newTokens);

                if (dailyBonusInterval) clearInterval(dailyBonusInterval);
                elements.dailyBonusBtn.disabled = true;
                elements.menuDailyBonusBtn.disabled = true;
                let timeLeft = 24 * 60 * 60;
                elements.dailyBonusBtn.textContent = formatTime(timeLeft);
                elements.menuDailyBonusBtn.textContent = formatTime(timeLeft);
                elements.menuDailyBonusText.textContent = `Come back in ${formatTime(timeLeft)} to claim your next bonus!`;

                dailyBonusInterval = setInterval(() => {
                    timeLeft--;
                    if (timeLeft <= 0) {
                        clearInterval(dailyBonusInterval);
                        elements.dailyBonusBtn.disabled = false;
                        elements.menuDailyBonusBtn.disabled = false;
                        elements.dailyBonusBtn.textContent = `Day ${currentDay + 1}`;
                        elements.menuDailyBonusBtn.textContent = `Day ${currentDay + 1}`;
                        elements.menuDailyBonusText.textContent = `Claim your Day ${currentDay + 1} bonus!`;
                        elements.dailyBonusBtn.onclick = claimDailyBonus;
                        elements.menuDailyBonusBtn.onclick = claimDailyBonus;
                        return;
                    }
                    elements.dailyBonusBtn.textContent = formatTime(timeLeft);
                    elements.menuDailyBonusBtn.textContent = formatTime(timeLeft);
                    elements.menuDailyBonusText.textContent = `Come back in ${formatTime(timeLeft)} to claim your next bonus!`;
                }, 1000);

                alert(`Successfully claimed ${bonus} ARPM for Day ${currentDay === 0 ? 7 : currentDay}!`);
            } catch (error) {
                console.error('Error claiming daily bonus:', error);
                alert('Failed to claim daily bonus. Please try again.');
            }
        }

        /**
         * Updates the login bonus button based on user data.
         * @param {Object} userData - The user's data from Firebase.
         */
        async function updateLoginBonusButton(userData) {
            if (!elements.loginBonusBtn || !elements.menuLoginBonusBtn) return;

            const isClaimed = userData.loginBonusClaimed || false;
            const claimButton = document.getElementById('claim-login-bonus-btn');
            const loginBonusContent = document.getElementById('login-bonus-content');
            const menuLoginBonusContent = document.getElementById('menu-login-bonus-content');

            if (isClaimed) {
                if (elements.loginBonusBtn) elements.loginBonusBtn.style.display = 'none';
                if (loginBonusContent) loginBonusContent.style.display = 'none';
                if (elements.menuLoginBonusBtn?.parentElement) elements.menuLoginBonusBtn.parentElement.style.display = 'none';
                if (menuLoginBonusContent) menuLoginBonusContent.style.display = 'none';
            } else {
                if (elements.loginBonusBtn) elements.loginBonusBtn.style.display = 'flex';
                if (elements.menuLoginBonusBtn?.parentElement) elements.menuLoginBonusBtn.parentElement.style.display = 'flex';
                elements.loginBonusBtn.disabled = false;
                elements.menuLoginBonusBtn.disabled = false;
                elements.loginBonusBtn.textContent = 'Bonus';
                elements.menuLoginBonusBtn.textContent = 'Claim Bonus';
                elements.loginBonusBtn.style.cursor = 'pointer';
                elements.menuLoginBonusBtn.style.cursor = 'pointer';
                if (claimButton) {
                    claimButton.textContent = 'Claim Bonus';
                    claimButton.disabled = false;
                    claimButton.style.cursor = 'pointer';
                    claimButton.onclick = claimLoginBonus;
                }
                elements.menuLoginBonusBtn.onclick = claimLoginBonus;
            }
        }

        /**
         * Claims the login bonus and updates user data.
         */
        async function claimLoginBonus() {
            const user = auth.currentUser;
            if (!user) {
                alert('Please login to claim login bonus!');
                window.location.href = 'login.html';
                return;
            }

            const userRef = ref(db, `users/${user.uid}`);
            try {
                const snapshot = await get(userRef);
                if (!snapshot.exists()) {
                    alert('User data not found.');
                    return;
                }

                const userData = snapshot.val();
                if (userData.loginBonusClaimed) {
                    alert('Login bonus already claimed!');
                    return;
                }

                const newTokens = (userData.tokens || 0) + LOGIN_BONUS;

                // Add history entry
                const historyRef = ref(db, `users/${user.uid}/history`);
                await push(historyRef, {
                    type: 'Login Bonus',
                    amount: LOGIN_BONUS,
                    date: new Date().toLocaleDateString('en-GB')
                });

                await update(userRef, {
                    tokens: newTokens,
                    loginBonusClaimed: true
                });

                // Handle referrer bonus
                if (userData.referredBy) {
                    const referrerRef = ref(db, `users/${userData.referredBy}`);
                    const referrerSnapshot = await get(referrerRef);
                    if (referrerSnapshot.exists()) {
                        const referrerData = referrerSnapshot.val();
                        const bonus = LOGIN_BONUS * REFERRAL_BONUS_PERCENT;
                        const referrerTokens = (referrerData.tokens || 0) + bonus;
                        const referrerHistoryRef = ref(db, `users/${userData.referredBy}/history`);
                        await push(referrerHistoryRef, {
                            type: 'Referral Bonus',
                            amount: bonus,
                            date: new Date().toLocaleDateString('en-GB')
                        });
                        await update(referrerRef, { tokens: referrerTokens });
                    }
                }

                updateBalance(user, newTokens);
                if (elements.loginBonusBtn) elements.loginBonusBtn.style.display = 'none';
                if (document.getElementById('login-bonus-content')) document.getElementById('login-bonus-content').style.display = 'none';
                if (elements.menuLoginBonusBtn?.parentElement) elements.menuLoginBonusBtn.parentElement.style.display = 'none';
                if (document.getElementById('menu-login-bonus-content')) document.getElementById('menu-login-bonus-content').style.display = 'none';
                alert(`Successfully claimed ${LOGIN_BONUS} ARPM login bonus!`);
            } catch (error) {
                console.error('Error claiming login bonus:', error);
                alert('Failed to claim login bonus. Please try again.');
            }
        }

        /**
         * Updates the referral information in the UI.
         * @param {Object} user - The authenticated user.
         * @param {Object} userData - The user's data from Firebase.
         */
        async function updateReferralInfo(user, userData) {
            const referralLink = `https://arpmmining.github.io/Arpmmining/?ref=${userData.uniqueCode}`;
            if (elements.inviteReferralLink) elements.inviteReferralLink.textContent = referralLink;
            if (elements.inviteReferralCount) elements.inviteReferralCount.textContent = `Referrals: ${userData.referrals || 0}`;
            if (elements.menuInviteReferralLink) elements.menuInviteReferralLink.textContent = referralLink;
            if (elements.menuInviteReferralCount) elements.menuInviteReferralCount.textContent = `Referrals: ${userData.referrals || 0}`;
        }

        /**
         * Updates the mining button based on user data.
         * @param {Object} user - The authenticated user.
         * @param {Object} userData - The user's data from Firebase.
         */
        async function updateMiningButton(user, userData) {
            if (!elements.startMiningBtn) return;

            const now = Date.now();
            const miningEndTime = userData.miningEndTime || 0;
            const miningStartTime = userData.miningStartTime || 0;
            let minedTokens = userData.minedTokens || 0;

            if (miningInterval) clearInterval(miningInterval);

            if (miningEndTime > now && miningStartTime !== 0) {
                // Mining is in progress
                elements.startMiningBtn.disabled = true;
                let timeLeft = Math.floor((miningEndTime - now) / 1000);

                // Calculate tokens based on elapsed time
                const elapsedTime = (now - miningStartTime) / 1000;
                minedTokens = (MINING_REWARD / (MINING_DURATION / 1000)) * elapsedTime;
                minedTokens = Math.min(minedTokens, MINING_REWARD); // Cap at MINING_REWARD

                elements.startMiningBtn.innerHTML = `Time Left:<br>${formatTime(timeLeft)}<br>Tokens: ${minedTokens.toFixed(3)}`;

                miningInterval = setInterval(async () => {
                    timeLeft--;
                    const currentTime = Date.now();
                    minedTokens = (MINING_REWARD / (MINING_DURATION / 1000)) * ((currentTime - miningStartTime) / 1000);
                    minedTokens = Math.min(minedTokens, MINING_REWARD);

                    if (timeLeft <= 0) {
                        clearInterval(miningInterval);
                        const userRef = ref(db, `users/${user.uid}`);
                        const snapshot = await get(userRef);
                        if (snapshot.exists()) {
                            const updatedData = snapshot.val();
                            elements.startMiningBtn.disabled = false;
                            elements.startMiningBtn.innerHTML = 'Claim';
                            elements.startMiningBtn.onclick = () => claimMiningReward(user, userRef, updatedData);
                        }
                        return;
                    }

                    elements.startMiningBtn.innerHTML = `Time Left:<br>${formatTime(timeLeft)}<br>Tokens: ${minedTokens.toFixed(3)}`;

                    // Update minedTokens in Firebase every minute
                    if (timeLeft % 60 === 0) {
                        try {
                            await update(ref(db, `users/${user.uid}`), { minedTokens });
                        } catch (error) {
                            console.error('Error updating mined tokens:', error);
                        }
                    }
                }, 1000);
            } else if (miningEndTime !== 0 && miningStartTime !== 0) {
                // Mining completed but not claimed
                elements.startMiningBtn.disabled = false;
                elements.startMiningBtn.innerHTML = 'Claim';
                elements.startMiningBtn.onclick = () => claimMiningReward(user, ref(db, `users/${user.uid}`), userData);
            } else {
                // No mining in progress
                elements.startMiningBtn.disabled = false;
                elements.startMiningBtn.innerHTML = 'START MINING';
                elements.startMiningBtn.onclick = startMining;
            }
        }

        /**
         * Displays a specific page and updates the UI, including update banner visibility.
         * @param {string} page - The ID of the page to display.
         */
        async function showPage(page) {
            await showLoadingScreen(true);
            Object.values(elements).forEach(c => {
                if (c?.classList && c !== elements.menuPanel && c !== elements.menuOverlay && c !== elements.updateBanner) {
                    c.classList.remove('active');
                }
            });
            if (elements[page]) elements[page].classList.add('active');

            if (page === 'homeSection' && !elements.menuPanel?.classList.contains('active') && !elements.updateBanner?.style.display) {
                elements.updateBanner?.classList.remove('hidden');
                setTimeout(updateMarquee, 1000);
            } else {
                elements.updateBanner?.classList.add('hidden');
            }

            if (page === 'homeSection') {
                const user = auth.currentUser;
                if (user) {
                    const userRef = ref(db, `users/${user.uid}`);
                    const snapshot = await get(userRef);
                    if (snapshot.exists()) {
                        const userData = snapshot.val();
                        updateDailyBonusButton(userData);
                        updateLoginBonusButton(userData);
                        updateMiningButton(user, userData);
                        updateReferralInfo(user, userData);
                        setTimeout(displayRandomAd, 500);
                    }
                }
            }

            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(nav => nav.classList.remove('active'));
            const activeNav = document.querySelector(`.nav-item[data-target="${page}"]`);
            if (activeNav) activeNav.classList.add('active');
        }

        /**
         * Copies the referral link to the clipboard.
         * @param {string} elementId - The ID of the element containing the referral link.
         */
        window.copyReferralLink = async (elementId) => {
            const referralLinkElement = document.getElementById(elementId);
            if (!referralLinkElement) return;
            const referralLink = referralLinkElement.textContent;
            try {
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    await navigator.clipboard.writeText(referralLink);
                    alert('Referral link copied to clipboard!');
                } else {
                    const textarea = document.createElement('textarea');
                    textarea.value = referralLink;
                    document.body.appendChild(textarea);
                    textarea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textarea);
                    alert('Referral link copied to clipboard!');
                }
            } catch (error) {
                console.error('Failed to copy referral link:', error);
                alert('Failed to copy referral link: ' + error.message);
            }
        };

        /**
         * Toggles the invite content visibility.
         */
        window.toggleInvite = () => {
            const inviteContent = document.getElementById('invite-content');
            const loginBonusContent = document.getElementById('login-bonus-content');
            if (inviteContent) inviteContent.classList.toggle('active');
            if (loginBonusContent?.classList.contains('active')) loginBonusContent.classList.remove('active');
        };

        /**
         * Toggles the login bonus content visibility.
         */
        window.toggleLoginBonus = () => {
            const loginBonusContent = document.getElementById('login-bonus-content');
            const inviteContent = document.getElementById('invite-content');
            if (loginBonusContent) loginBonusContent.classList.toggle('active');
            if (inviteContent?.classList.contains('active')) inviteContent.classList.remove('active');
        };

        /**
         * Starts the mining process.
         */
        async function startMining() {
            const user = auth.currentUser;
            if (!user) {
                alert('Please login to start mining!');
                window.location.href = 'login.html';
                return;
            }

            const userRef = ref(db, `users/${user.uid}`);
            try {
                const snapshot = await get(userRef);
                if (!snapshot.exists()) {
                    alert('User data not found.');
                    return;
                }

                const userData = snapshot.val();
                if (userData.miningEndTime > Date.now()) {
                    alert('Mining is already in progress! Please wait until it completes.');
                    return;
                }
                if (userData.miningEndTime !== 0 && userData.miningStartTime !== 0) {
                    await claimMiningReward(user, userRef, userData);
                    return;
                }

                if (miningInterval) clearInterval(miningInterval);

                const now = Date.now();
                await update(userRef, {
                    miningStartTime: now,
                    miningEndTime: now + MINING_DURATION,
                    minedTokens: 0
                });

                elements.startMiningBtn.disabled = true;
                let timeLeft = MINING_DURATION / 1000;
                let minedTokens = 0;

                elements.startMiningBtn.innerHTML = `Time Left:<br>${formatTime(timeLeft)}<br>Tokens: ${minedTokens.toFixed(3)}`;

                miningInterval = setInterval(async () => {
                    timeLeft--;
                    const currentTime = Date.now();
                    minedTokens = (MINING_REWARD / (MINING_DURATION / 1000)) * ((currentTime - now) / 1000);
                    minedTokens = Math.min(minedTokens, MINING_REWARD);

                    if (timeLeft <= 0) {
                        clearInterval(miningInterval);
                        const snapshot = await get(userRef);
                        if (snapshot.exists()) {
                            const updatedData = snapshot.val();
                            elements.startMiningBtn.disabled = false;
                            elements.startMiningBtn.innerHTML = 'Claim';
                            elements.startMiningBtn.onclick = () => claimMiningReward(user, userRef, updatedData);
                        }
                        return;
                    }

                    elements.startMiningBtn.innerHTML = `Time Left:<br>${formatTime(timeLeft)}<br>Tokens: ${minedTokens.toFixed(3)}`;

                    // Update minedTokens in Firebase every minute
                    if (timeLeft % 60 === 0) {
                        try {
                            await update(userRef, { minedTokens });
                        } catch (error) {
                            console.error('Error updating mined tokens:', error);
                        }
                    }
                }, 1000);
            } catch (error) {
                console.error('Error starting mining:', error);
                alert('Failed to start mining. Please try again.');
            }
        }

        /**
         * Claims the mining reward and updates user data.
         * @param {Object} user - The authenticated user.
         * @param {Object} userRef - The Firebase reference to the user.
         * @param {Object} userData - The user's data.
         */
        async function claimMiningReward(user, userRef, userData) {
            try {
                const newTokens = (userData.tokens || 0) + MINING_REWARD;

                // Add history entry
                const historyRef = ref(db, `users/${user.uid}/history`);
                await push(historyRef, {
                    type: 'Start Mining',
                    amount: MINING_REWARD,
                    date: new Date().toLocaleDateString('en-GB')
                });

                await update(userRef, {
                    tokens: newTokens,
                    miningStartTime: 0,
                    miningEndTime: 0,
                    minedTokens: 0
                });

                // Handle referrer bonus
                if (userData.referredBy) {
                    const referrerRef = ref(db, `users/${userData.referredBy}`);
                    const referrerSnapshot = await get(referrerRef);
                    if (referrerSnapshot.exists()) {
                        const referrerData = referrerSnapshot.val();
                        const bonus = MINING_REWARD * REFERRAL_BONUS_PERCENT;
                        const referrerTokens = (referrerData.tokens || 0) + bonus;
                        const referrerHistoryRef = ref(db, `users/${userData.referredBy}/history`);
                        await push(referrerHistoryRef, {
                            type: 'Referral Bonus',
                            amount: bonus,
                            date: new Date().toLocaleDateString('en-GB')
                        });
                        await update(referrerRef, { tokens: referrerTokens });
                    }
                }

                updateBalance(user, newTokens);
                elements.startMiningBtn.disabled = false;
                elements.startMiningBtn.innerHTML = 'START MINING';
                elements.startMiningBtn.onclick = startMining;
                alert('Mining completed! You earned 12 ARPM.');
            } catch (error) {
                console.error('Error claiming mining reward:', error);
                alert('Failed to claim mining reward. Please try again.');
            }
        }

        /**
         * Handles authentication state changes and initializes the UI.
         */
        if (auth && onAuthStateChanged) {
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    const userRef = ref(db, `users/${user.uid}`);
                    try {
                        const snapshot = await get(userRef);
                        if (snapshot.exists()) {
                            const userData = snapshot.val();
                            updateBalance(user, userData.tokens || 0);
                            if (elements.homeSection?.classList.contains('active')) {
                                updateDailyBonusButton(userData);
                                updateLoginBonusButton(userData);
                                updateMiningButton(user, userData);
                                updateReferralInfo(user, userData);
                                setTimeout(displayRandomAd, 500);
                                if (!elements.menuPanel?.classList.contains('active') && !elements.updateBanner?.style.display) {
                                    elements.updateBanner?.classList.remove('hidden');
                                    setTimeout(updateMarquee, 1000);
                                }
                            }
                        }
                        showPage('homeSection');
                    } catch (error) {
                        console.error('Error loading user data:', error);
                        alert('Failed to load user data. Please try again.');
                    }
                } else {
                    if (miningInterval) clearInterval(miningInterval);
                    if (dailyBonusInterval) clearInterval(dailyBonusInterval);
                    window.location.href = 'login.html';
                }
            });
        }

        /**
         * Initializes navigation event listeners.
         */
        const navItems = document.querySelectorAll('.nav-item');
        navItems.forEach(item => {
            // Remove existing listeners to prevent duplicates
            item.removeEventListener('click', handleNavClick);
            item.removeEventListener('touchstart', handleTouchStart);
            item.removeEventListener('touchend', handleTouchEnd);

            item.addEventListener('click', handleNavClick);
            item.addEventListener('touchstart', handleTouchStart);
            item.addEventListener('touchend', handleTouchEnd);
        });

        function handleNavClick() {
            const target = this.getAttribute('data-target');
            navItems.forEach(nav => nav.classList.remove('active'));
            this.classList.add('active');
            if (target === 'incomeSection') {
                window.location.href = 'income.html';
            } else if (target === 'profileSection') {
                window.location.href = 'profile.html';
            } else if (target === 'walletSection') {
                window.location.href = 'wallet.html';
            } else {
                showPage(target);
            }
            toggleMenu();
        }

        function handleTouchStart() {
            this.style.transform = 'scale(0.95)';
        }

        function handleTouchEnd() {
            this.style.transform = 'scale(1)';
        }

        /**
         * Adds touch feedback for the start mining button.
         */
        if (elements.startMiningBtn) {
            elements.startMiningBtn.removeEventListener('touchstart', handleMiningTouchStart);
            elements.startMiningBtn.removeEventListener('touchend', handleMiningTouchEnd);
            elements.startMiningBtn.removeEventListener('click', startMining);

            elements.startMiningBtn.addEventListener('touchstart', handleMiningTouchStart);
            elements.startMiningBtn.addEventListener('touchend', handleMiningTouchEnd);
            elements.startMiningBtn.addEventListener('click', startMining);
        }

        function handleMiningTouchStart() {
            if (!elements.startMiningBtn.disabled) {
                elements.startMiningBtn.style.transform = 'scale(0.95)';
            }
        }

        function handleMiningTouchEnd() {
            elements.startMiningBtn.style.transform = 'scale(1)';
        }

        /**
         * Signs out the user and redirects to the login page.
         */
        window.signOut = async () => {
            alert('Logging out...');
            if (miningInterval) clearInterval(miningInterval);
            if (dailyBonusInterval) clearInterval(dailyBonusInterval);
            try {
                await signOut(auth);
                window.location.href = 'login.html';
            } catch (error) {
                alert('Logout failed: ' + error.message);
            }
        };

        /**
         * Initializes the page with a loading screen.
         */
        window.addEventListener('load', async () => {
            if (elements.menuPanel) elements.menuPanel.classList.remove('active');
            if (elements.menuOverlay) elements.menuOverlay.classList.remove('active');
            if (elements.homeSection?.classList.contains('active') && !elements.updateBanner?.style.display) {
                elements.updateBanner?.classList.remove('hidden');
                setTimeout(updateMarquee, 1000);
            }
            await showLoadingScreen(true);
        });

        /**
         * Menu event listeners
         */
        if (elements.menuBtn) elements.menuBtn.addEventListener('click', toggleMenu);
        if (elements.closeMenu) elements.closeMenu.addEventListener('click', toggleMenu);
        if (elements.menuOverlay) elements.menuOverlay.addEventListener('click', toggleMenu);
    </script>
</body>
</html>